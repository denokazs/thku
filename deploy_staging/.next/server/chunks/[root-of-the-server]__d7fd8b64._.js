module.exports=[14747,(e,t,s)=>{t.exports=e.x("path",()=>require("path"))},24361,(e,t,s)=>{t.exports=e.x("util",()=>require("util"))},22734,(e,t,s)=>{t.exports=e.x("fs",()=>require("fs"))},62294,e=>{"use strict";let t,s;e.i(22734),e.i(14747).default.join(process.cwd(),"data","thk.db");let a={host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASS||"",database:process.env.DB_NAME||"thk_db",waitForConnections:!0,connectionLimit:10,queueLimit:0};try{t=e.r(22244)}catch(e){}try{let e=Error("Cannot find module 'better-sqlite3'");throw e.code="MODULE_NOT_FOUND",e}catch(e){}function r(){if(!t)throw Error("mysql2 driver not found");return s||(s=t.createPool(a)),s}let o=e=>{try{if("object"==typeof e)return e;return e?JSON.parse(e):[]}catch(e){return[]}},n=e=>"string"==typeof e?e:JSON.stringify(e||[]),i={users:{table:"users",json:"users",type:"array"},clubs:{table:"clubs",json:"clubs",type:"array",jsonFields:["president","gallery","badges","socialMedia"]},events:{table:"events",json:"events",type:"array",jsonFields:["images","schedule","speakers","faq"],boolFields:["isPast","isFeatured"]},announcements:{table:"announcements",json:"announcements",type:"array"},news:{table:"news",json:"news",type:"array"},confessions:{table:"confessions",json:"confessions",type:"array"},comments:{table:"comments",json:"comments",type:"array"},messages:{table:"messages",json:"messages",type:"array",jsonFields:["internalNotes"]},forumPosts:{table:"forum_posts",json:"forumPosts",type:"array",jsonFields:["likes","comments"]},members:{table:"members",json:"members",type:"array"},shuttleStops:{table:"shuttle_stops",json:"shuttleStops",type:"array"},cafeteriaMenu:{table:"cafeteria_menu",json:"cafeteriaMenu",type:"object",key:"date"},settings:{table:"settings",json:"settings",type:"kv"}};async function l(e){return y(e)}async function c(e){return u(e)}async function y(e){let t=r(),s={};for(let a of e||Object.keys(i)){if(!i[a])continue;let e=i[a];try{if("array"===e.type){let[a]=await t.query(`SELECT * FROM ${e.table}`);s[e.json]=a.map(t=>{let s={...t};return e.jsonFields&&e.jsonFields.forEach(e=>{s[e]&&(s[e]=o(s[e]))}),e.boolFields&&e.boolFields.forEach(e=>s[e]=!!s[e]),s})}else if("kv"===e.type){let[a]=await t.query(`SELECT * FROM ${e.table}`),r={};a.forEach(e=>{try{r[e.key]=JSON.parse(e.value)}catch{r[e.key]=e.value}}),s[e.json]=r.site_settings||r}else if("object"===e.type){let[a]=await t.query(`SELECT * FROM ${e.table}`),r={};a.forEach(t=>{r[t[e.key]]=t}),s[e.json]=r}}catch(t){console.error(`Error fetching ${a}:`,t.message),s[e.json]="array"===e.type?[]:{}}}return s}async function u(e){let t=r(),s=await t.getConnection();try{for(let t in await s.beginTransaction(),i){let a=i[t],r=e[a.json];if(r){if("array"===a.type){if(!Array.isArray(r)||(await s.query(`DELETE FROM ${a.table}`),0===r.length))continue;let[e]=await s.query(`SHOW COLUMNS FROM ${a.table}`),t=e.map(e=>e.Field);if(0===t.length)continue;let o=t.map(()=>"?").join(", "),i=t.map(e=>`\`${e}\``).join(", "),l=`INSERT INTO ${a.table} (${i}) VALUES (${o})`;for(let e of r){let r={...e};a.jsonFields&&a.jsonFields.forEach(e=>r[e]=n(r[e])),a.boolFields&&a.boolFields.forEach(e=>r[e]=+!!r[e]);let o=t.map(e=>void 0===r[e]?null:r[e]);await s.query(l,o)}}else if("kv"===a.type){let e=JSON.stringify(r);await s.query(`REPLACE INTO ${a.table} (\`key\`, value) VALUES (?, ?)`,["site_settings",e])}else if("object"===a.type){let[e]=await s.query(`SHOW COLUMNS FROM ${a.table}`),t=e.map(e=>e.Field),o=t.map(()=>"?").join(", "),n=t.map(e=>`\`${e}\``).join(", "),i=`INSERT INTO ${a.table} (${n}) VALUES (${o})`;for(let e in await s.query(`DELETE FROM ${a.table}`),r){let o={...r[e],[a.key]:e},n=t.map(e=>void 0===o[e]?null:o[e]);await s.query(i,n)}}}}await s.commit()}catch(e){throw await s.rollback(),e}finally{s.release()}}e.s(["readDb",()=>l,"writeDb",()=>c])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d7fd8b64._.js.map