{"version":3,"sources":["../../../lib/db.ts"],"sourcesContent":["\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\n// Database configuration\r\nconst DB_SQLITE_PATH = path.join(process.cwd(), 'data', 'thk.db');\r\n\r\nconst dbConfig = {\r\n    host: process.env.DB_HOST || 'localhost',\r\n    user: process.env.DB_USER || 'root',\r\n    password: process.env.DB_PASS || '',\r\n    database: process.env.DB_NAME || 'thk_db',\r\n    waitForConnections: true,\r\n    connectionLimit: 10,\r\n    queueLimit: 0\r\n};\r\n\r\n// Driver loading\r\nlet mysql: any;\r\nlet Database: any;\r\n\r\ntry {\r\n    mysql = require('mysql2/promise');\r\n} catch (e) {\r\n    // MySQL not available\r\n}\r\n\r\ntry {\r\n    Database = require('better-sqlite3');\r\n} catch (e) {\r\n    // SQLite not available\r\n}\r\n\r\n// Singleton instances\r\nlet mysqlPool: any;\r\nlet sqliteDb: any;\r\n\r\nfunction getSqliteDb() {\r\n    if (!Database) throw new Error('better-sqlite3 driver not found');\r\n    if (!sqliteDb) {\r\n        // Ensure data directory exists\r\n        const dataDir = path.dirname(DB_SQLITE_PATH);\r\n        if (!fs.existsSync(dataDir)) {\r\n            fs.mkdirSync(dataDir, { recursive: true });\r\n        }\r\n\r\n        sqliteDb = new Database(DB_SQLITE_PATH);\r\n        sqliteDb.pragma('journal_mode = WAL');\r\n        sqliteDb.pragma('synchronous = NORMAL');\r\n    }\r\n    return sqliteDb;\r\n}\r\n\r\nfunction getMysqlPool() {\r\n    if (!mysql) throw new Error('mysql2 driver not found');\r\n    if (!mysqlPool) {\r\n        mysqlPool = mysql.createPool(dbConfig);\r\n    }\r\n    return mysqlPool;\r\n}\r\n\r\n// Helpers\r\nconst parseJSON = (str: any) => {\r\n    try {\r\n        if (typeof str === 'object') return str;\r\n        return str ? JSON.parse(str) : [];\r\n    } catch (e) {\r\n        return [];\r\n    }\r\n};\r\n\r\nconst stringifyJSON = (val: any) => {\r\n    if (typeof val === 'string') return val;\r\n    return JSON.stringify(val || []);\r\n};\r\n\r\n// MAPPINGS\r\nconst MAPPINGS: any = {\r\n    users: { table: 'users', json: 'users', type: 'array' },\r\n    clubs: { table: 'clubs', json: 'clubs', type: 'array', jsonFields: ['president', 'gallery', 'badges', 'socialMedia'] },\r\n    events: { table: 'events', json: 'events', type: 'array', jsonFields: ['images', 'schedule', 'speakers', 'faq'], boolFields: ['isPast', 'isFeatured'] },\r\n    announcements: { table: 'announcements', json: 'announcements', type: 'array' },\r\n    news: { table: 'news', json: 'news', type: 'array' },\r\n    confessions: { table: 'confessions', json: 'confessions', type: 'array' },\r\n    comments: { table: 'comments', json: 'comments', type: 'array' },\r\n    messages: { table: 'messages', json: 'messages', type: 'array', jsonFields: ['internalNotes'] },\r\n    forumPosts: { table: 'forum_posts', json: 'forumPosts', type: 'array', jsonFields: ['likes', 'comments'] },\r\n    members: { table: 'members', json: 'members', type: 'array' },\r\n    shuttleStops: { table: 'shuttle_stops', json: 'shuttleStops', type: 'array' },\r\n    cafeteriaMenu: { table: 'cafeteria_menu', json: 'cafeteriaMenu', type: 'object', key: 'date' },\r\n    settings: { table: 'settings', json: 'settings', type: 'kv' }\r\n};\r\n\r\nexport async function readDb(tableNames?: string[]) {\r\n    // Check environment or default to sqlite if mysql config is missing/default\r\n    const useMysql = process.env.NODE_ENV === 'production' || process.env.DB_TYPE === 'mysql';\r\n\r\n    if (useMysql) {\r\n        return readDbMysql(tableNames);\r\n    } else {\r\n        return readDbSqlite(tableNames);\r\n    }\r\n}\r\n\r\nexport async function writeDb(data: any) {\r\n    const useMysql = process.env.NODE_ENV === 'production' || process.env.DB_TYPE === 'mysql';\r\n\r\n    if (useMysql) {\r\n        return writeDbMysql(data);\r\n    } else {\r\n        return writeDbSqlite(data);\r\n    }\r\n}\r\n\r\n// --- Implementation: SQLite ---\r\n\r\nasync function readDbSqlite(tableNames?: string[]) {\r\n    const db = getSqliteDb();\r\n    const data: any = {};\r\n    const keysToFetch = tableNames ? tableNames : Object.keys(MAPPINGS);\r\n\r\n    for (const key of keysToFetch) {\r\n        if (!MAPPINGS[key]) continue;\r\n        const config = MAPPINGS[key];\r\n        try {\r\n            if (config.type === 'array') {\r\n                const rows = db.prepare(`SELECT * FROM ${config.table}`).all();\r\n                data[config.json] = rows.map((row: any) => {\r\n                    const newRow = { ...row };\r\n                    if (config.jsonFields) config.jsonFields.forEach((f: string) => newRow[f] = parseJSON(newRow[f]));\r\n                    if (config.boolFields) config.boolFields.forEach((f: string) => newRow[f] = Boolean(newRow[f]));\r\n                    return newRow;\r\n                });\r\n            } else if (config.type === 'kv') {\r\n                const rows = db.prepare(`SELECT * FROM ${config.table}`).all();\r\n                const settingsObj: any = {};\r\n                rows.forEach((r: any) => {\r\n                    try { settingsObj[r.key] = JSON.parse(r.value); } catch { settingsObj[r.key] = r.value; }\r\n                });\r\n                data[config.json] = settingsObj['site_settings'] || settingsObj;\r\n            } else if (config.type === 'object') {\r\n                const rows = db.prepare(`SELECT * FROM ${config.table}`).all();\r\n                const obj: any = {};\r\n                rows.forEach((row: any) => { obj[row[config.key]] = row; });\r\n                data[config.json] = obj;\r\n            }\r\n        } catch (e) {\r\n            // Ignore missing tables\r\n            data[config.json] = config.type === 'array' ? [] : {};\r\n        }\r\n    }\r\n    return data;\r\n}\r\n\r\nasync function writeDbSqlite(data: any) {\r\n    const db = getSqliteDb();\r\n    const transaction = db.transaction((data: any) => {\r\n        for (const key in MAPPINGS) {\r\n            const config = MAPPINGS[key];\r\n            const inputData = data[config.json];\r\n            if (!inputData) continue;\r\n\r\n            if (config.type === 'array') {\r\n                if (!Array.isArray(inputData)) continue;\r\n                db.prepare(`DELETE FROM ${config.table}`).run();\r\n                if (inputData.length === 0) continue;\r\n\r\n                const columns = db.prepare(`PRAGMA table_info(${config.table})`).all().map((c: any) => c.name);\r\n                const insertParams = columns.map(() => '?').join(', '); // Use ? for safe parameter binding in better-sqlite3\r\n                const insertStmt = db.prepare(`INSERT INTO ${config.table} (${columns.join(', ')}) VALUES (${insertParams})`);\r\n\r\n                for (const item of inputData) {\r\n                    const row = { ...item };\r\n                    if (config.jsonFields) config.jsonFields.forEach((f: string) => row[f] = stringifyJSON(row[f]));\r\n                    if (config.boolFields) config.boolFields.forEach((f: string) => row[f] = row[f] ? 1 : 0);\r\n\r\n                    const values = columns.map((col: string) => row[col] === undefined ? null : row[col]);\r\n                    insertStmt.run(...values);\r\n                }\r\n            } else if (config.type === 'kv') {\r\n                const val = JSON.stringify(inputData);\r\n                db.prepare(`INSERT OR REPLACE INTO ${config.table} (key, value) VALUES (?, ?)`).run('site_settings', val);\r\n            } else if (config.type === 'object') {\r\n                db.prepare(`DELETE FROM ${config.table}`).run();\r\n                const columns = db.prepare(`PRAGMA table_info(${config.table})`).all().map((c: any) => c.name);\r\n                const insertParams = columns.map(() => '?').join(', ');\r\n                const insertStmt = db.prepare(`INSERT INTO ${config.table} (${columns.join(', ')}) VALUES (${insertParams})`);\r\n\r\n                for (const dateKey in inputData) {\r\n                    const item = inputData[dateKey];\r\n                    const row = { ...item, [config.key]: dateKey };\r\n                    const values = columns.map((col: string) => row[col] === undefined ? null : row[col]);\r\n                    insertStmt.run(...values);\r\n                }\r\n            }\r\n        }\r\n    });\r\n    transaction(data);\r\n}\r\n\r\n\r\n// --- Implementation: MySQL ---\r\n\r\nasync function readDbMysql(tableNames?: string[]) {\r\n    const db = getMysqlPool();\r\n    const data: any = {};\r\n    const keysToFetch = tableNames ? tableNames : Object.keys(MAPPINGS);\r\n\r\n    for (const key of keysToFetch) {\r\n        if (!MAPPINGS[key]) continue;\r\n        const config = MAPPINGS[key];\r\n        try {\r\n            if (config.type === 'array') {\r\n                const [rows]: any = await db.query(`SELECT * FROM ${config.table}`);\r\n                data[config.json] = rows.map((row: any) => {\r\n                    const newRow = { ...row };\r\n                    if (config.jsonFields) config.jsonFields.forEach((f: string) => { if (newRow[f]) newRow[f] = parseJSON(newRow[f]); });\r\n                    if (config.boolFields) config.boolFields.forEach((f: string) => newRow[f] = Boolean(newRow[f]));\r\n                    return newRow;\r\n                });\r\n            } else if (config.type === 'kv') {\r\n                const [rows]: any = await db.query(`SELECT * FROM ${config.table}`);\r\n                const settingsObj: any = {};\r\n                rows.forEach((r: any) => { try { settingsObj[r.key] = JSON.parse(r.value); } catch { settingsObj[r.key] = r.value; } });\r\n                data[config.json] = settingsObj['site_settings'] || settingsObj;\r\n            } else if (config.type === 'object') {\r\n                const [rows]: any = await db.query(`SELECT * FROM ${config.table}`);\r\n                const obj: any = {};\r\n                rows.forEach((row: any) => { obj[row[config.key]] = row; });\r\n                data[config.json] = obj;\r\n            }\r\n        } catch (err: any) {\r\n            console.error(`Error fetching ${key}:`, err.message);\r\n            data[config.json] = config.type === 'array' ? [] : {};\r\n        }\r\n    }\r\n    return data;\r\n}\r\n\r\nasync function writeDbMysql(data: any) {\r\n    const db = getMysqlPool();\r\n    const connection = await db.getConnection();\r\n\r\n    try {\r\n        await connection.beginTransaction();\r\n\r\n        for (const key in MAPPINGS) {\r\n            const config = MAPPINGS[key];\r\n            const inputData = data[config.json];\r\n            if (!inputData) continue;\r\n\r\n            if (config.type === 'array') {\r\n                if (!Array.isArray(inputData)) continue;\r\n                await connection.query(`DELETE FROM ${config.table}`);\r\n                if (inputData.length === 0) continue;\r\n\r\n                const [cols]: any = await connection.query(`SHOW COLUMNS FROM ${config.table}`);\r\n                const columns = cols.map((c: any) => c.Field);\r\n                if (columns.length === 0) continue;\r\n\r\n                const placeholders = columns.map(() => '?').join(', ');\r\n                const escapedColumns = columns.map((c: any) => `\\`${c}\\``).join(', ');\r\n                const sql = `INSERT INTO ${config.table} (${escapedColumns}) VALUES (${placeholders})`;\r\n\r\n                for (const item of inputData) {\r\n                    const row = { ...item };\r\n                    if (config.jsonFields) config.jsonFields.forEach((f: string) => row[f] = stringifyJSON(row[f]));\r\n                    if (config.boolFields) config.boolFields.forEach((f: string) => row[f] = row[f] ? 1 : 0);\r\n                    const values = columns.map((col: string) => row[col] === undefined ? null : row[col]);\r\n                    await connection.query(sql, values);\r\n                }\r\n            } else if (config.type === 'kv') {\r\n                const val = JSON.stringify(inputData);\r\n                await connection.query(`REPLACE INTO ${config.table} (\\`key\\`, value) VALUES (?, ?)`, ['site_settings', val]);\r\n            } else if (config.type === 'object') {\r\n                const [cols]: any = await connection.query(`SHOW COLUMNS FROM ${config.table}`);\r\n                const columns = cols.map((c: any) => c.Field);\r\n                const placeholders = columns.map(() => '?').join(', ');\r\n                const escapedColumns = columns.map((c: any) => `\\`${c}\\``).join(', ');\r\n                const sql = `INSERT INTO ${config.table} (${escapedColumns}) VALUES (${placeholders})`;\r\n                await connection.query(`DELETE FROM ${config.table}`);\r\n\r\n                for (const dateKey in inputData) {\r\n                    const item = inputData[dateKey];\r\n                    const row = { ...item, [config.key]: dateKey };\r\n                    const values = columns.map((col: string) => row[col] === undefined ? null : row[col]);\r\n                    await connection.query(sql, values);\r\n                }\r\n            }\r\n        }\r\n        await connection.commit();\r\n    } catch (err) {\r\n        await connection.rollback();\r\n        throw err;\r\n    } finally {\r\n        connection.release();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}