{"version":3,"sources":["../../../lib/admin-auth.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from 'jose';\r\nimport { cookies } from 'next/headers';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n// Use jose library for Edge runtime compatibility\r\nconst JWT_SECRET = new TextEncoder().encode(\r\n    process.env.JWT_SECRET || 'your-secret-key-change-this-in-production-min-32-chars'\r\n);\r\n\r\nconst COOKIE_NAME = 'admin-token';\r\n\r\nexport interface AdminSession {\r\n    isAdmin: boolean;\r\n    iat: number;\r\n    exp: number;\r\n}\r\n\r\n/**\r\n * Verifies admin password against environment variable hash\r\n */\r\nexport async function verifyAdminPassword(password: string): Promise<boolean> {\r\n    const hashedPassword = process.env.ADMIN_PASSWORD_HASH;\r\n\r\n    // Fallback for development - compare plain text password\r\n    if (!hashedPassword) {\r\n        console.warn('ADMIN_PASSWORD_HASH not set! Using fallback password check.');\r\n        const fallbackPassword = process.env.ADMIN_PASSWORD || 'admin123';\r\n        return password === fallbackPassword;\r\n    }\r\n\r\n    return bcrypt.compare(password, hashedPassword);\r\n}\r\n\r\n/**\r\n * Creates a JWT token for admin authentication\r\n */\r\nexport async function createAdminToken(): Promise<string> {\r\n    const token = await new SignJWT({ isAdmin: true })\r\n        .setProtectedHeader({ alg: 'HS256' })\r\n        .setIssuedAt()\r\n        .setExpirationTime('7d') // Token expires in 7 days\r\n        .sign(JWT_SECRET);\r\n\r\n    return token;\r\n}\r\n\r\n/**\r\n * Verifies a JWT token and returns the payload\r\n */\r\nexport async function verifyAdminToken(token: string): Promise<AdminSession | null> {\r\n    try {\r\n        const verified = await jwtVerify(token, JWT_SECRET);\r\n        return verified.payload as unknown as AdminSession;\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Sets the admin authentication cookie\r\n */\r\nexport async function setAdminCookie(token: string) {\r\n    const cookieStore = await cookies();\r\n    cookieStore.set(COOKIE_NAME, token, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === 'production',\r\n        sameSite: 'lax',\r\n        maxAge: 60 * 60 * 24 * 7, // 7 days\r\n        path: '/',\r\n    });\r\n}\r\n\r\n/**\r\n * Removes the admin authentication cookie\r\n */\r\nexport async function removeAdminCookie() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(COOKIE_NAME);\r\n}\r\n\r\n/**\r\n * Gets the admin token from cookies\r\n */\r\nexport async function getAdminToken(): Promise<string | null> {\r\n    const cookieStore = await cookies();\r\n    const cookie = cookieStore.get(COOKIE_NAME);\r\n    return cookie?.value || null;\r\n}\r\n\r\n/**\r\n * Verifies if the current request is from an authenticated admin\r\n */\r\nexport async function verifyAdminAuth(): Promise<boolean> {\r\n    const token = await getAdminToken();\r\n    if (!token) return false;\r\n\r\n    const session = await verifyAdminToken(token);\r\n    return session?.isAdmin === true;\r\n}\r\n\r\n/**\r\n * Helper to generate password hash (for setup only)\r\n */\r\nexport async function hashPassword(password: string): Promise<string> {\r\n    return bcrypt.hash(password, 10);\r\n}\r\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAGA,IAAM,EAAa,IAAI,cAAc,MAAM,CACvC,QAAQ,GAAG,CAAC,UAAU,EAAI,0DAGxB,EAAc,cAWb,eAAe,EAAoB,CAAgB,EACtD,IAAM,EAAiB,QAAQ,GAAG,CAAC,mBAAmB,QAGtD,AAAK,EAME,EANH,AAMG,OAAM,CAAC,IANO,GAMA,CAAC,EAAU,IAL5B,QAAQ,IAAI,CAAC,+DAEN,KADkB,QAAQ,AACb,GADgB,CAAC,cAAc,EAAI,UAAA,EAK/D,CAKO,eAAe,IAOlB,OANc,AAMP,MANa,IAAI,EAAA,OAAO,CAAC,CAAE,QAAS,EAAK,GAC3C,kBAAkB,CAAC,CAAE,IAAK,OAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,MAAM,AACxB,IAAI,CAAC,EAGd,CAKO,eAAe,EAAiB,CAAa,AATO,EAUvD,GAAI,CAEA,MAAO,CADU,MAAM,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,EAAO,EAAA,EACxB,OAAO,AAC3B,CAAE,MAAO,EAAO,CACZ,OAAO,IACX,CACJ,CAKO,eAAe,EAAe,CAAa,EAE9C,CADoB,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAAA,EACrB,GAAG,CAAC,EAAa,EAAO,CAChC,UAAU,EACV,QAAQ,EACR,SAAU,MACV,OAAQ,KAAK,EACb,GADkB,EACZ,GADiB,AAE3B,EACJ,CAKO,SAVkC,MAUnB,IAElB,CADoB,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAAA,EACrB,MAAM,CAAC,EACvB,CAKO,eAAe,IAElB,IAAM,EAAS,CADK,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAAA,EACN,GAAG,CAAC,GAC/B,OAAO,GAAQ,OAAS,IAC5B,CAKO,eAAe,IAClB,IAAM,EAAQ,MAAM,IACpB,GAAI,CAAC,EAAO,OAAO,EAEnB,IAAM,EAAU,MAAM,EAAiB,GACvC,OAAO,GAAS,WAAY,CAChC,CAKO,eAAe,EAAa,CAAgB,EAC/C,OAAO,EAAA,OAAM,CAAC,IAAI,CAAC,EAAU,GACjC"}